{"ast":null,"code":"module.exports = Pager;\n\nfunction Pager(pageSize) {\n  if (!(this instanceof Pager)) return new Pager(pageSize);\n  this.length = 0;\n  this.updates = [];\n  this.pages = new Array(16);\n  this.pageSize = pageSize || 1024;\n}\n\nPager.prototype.updated = function (page) {\n  if (page.updated || !this.updates) return;\n  page.updated = true;\n  this.updates.push(page);\n};\n\nPager.prototype.lastUpdate = function () {\n  if (!this.updates || !this.updates.length) return null;\n  var page = this.updates.pop();\n  page.updated = false;\n  return page;\n};\n\nPager.prototype.get = function (i, noAllocate) {\n  if (i >= this.pages.length) {\n    if (noAllocate) return;\n    this.pages = grow(this.pages, i, this.length);\n  }\n\n  var page = this.pages[i];\n\n  if (!page && !noAllocate) {\n    page = this.pages[i] = new Page(i, alloc(this.pageSize));\n    if (i >= this.length) this.length = i + 1;\n  }\n\n  return page;\n};\n\nPager.prototype.set = function (i, buf) {\n  if (i >= this.pages.length) this.pages = grow(this.pages, i, this.length);\n  if (i >= this.length) this.length = i + 1;\n\n  if (!buf) {\n    this.pages[i] = undefined;\n    return;\n  }\n\n  var page = this.pages[i];\n  var b = truncate(buf, this.pageSize);\n  if (page) page.buffer = b;else this.pages[i] = new Page(i, b);\n};\n\nPager.prototype.toBuffer = function () {\n  var list = new Array(this.length);\n  var empty = alloc(this.pageSize);\n\n  for (var i = 0; i < list.length; i++) {\n    list[i] = this.pages[i] ? this.pages[i].buffer : empty;\n  }\n\n  return Buffer.concat(list);\n};\n\nfunction grow(list, index, len) {\n  var nlen = list.length * 2;\n\n  while (nlen <= index) {\n    nlen *= 2;\n  }\n\n  var twice = new Array(nlen);\n\n  for (var i = 0; i < len; i++) {\n    twice[i] = list[i];\n  }\n\n  return twice;\n}\n\nfunction truncate(buf, len) {\n  if (buf.length === len) return buf;\n  if (buf.length > len) return buf.slice(0, len);\n  var cpy = alloc(len);\n  buf.copy(cpy);\n  return cpy;\n}\n\nfunction alloc(size) {\n  if (Buffer.alloc) return Buffer.alloc(size);\n  var buf = new Buffer(size);\n  buf.fill(0);\n  return buf;\n}\n\nfunction Page(i, buf) {\n  this.offset = i * buf.length;\n  this.buffer = buf;\n  this.updated = false;\n}","map":null,"metadata":{},"sourceType":"script"}